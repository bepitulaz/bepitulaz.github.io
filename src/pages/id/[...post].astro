---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import NavbarIndonesia from "../../components/NavbarIndonesia.astro";
import Footer from "../../components/Footer.astro";

export async function getStaticPaths() {
  const articles = await getCollection("blog", ({ id }) => {
    return id.startsWith('id/');
  });

  return articles.map((article) => {
    const category = article.data.categories[0].toLowerCase();
    const slug = article.slug.replace('id/', '');

    return {
      params: {
        post: `${category}/${slug}`,
      },
      props: { article },
    };
  });
}

const { article } = Astro.props;
const { Content } = await article.render();
// Format date into DD MMMM YYYY from article.data.date
const date = new Date(article.data.date);
const formattedDate = date.toLocaleDateString("en-GB", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<Layout title={`${article.data.title} | Asep Bagja`}>
  <NavbarIndonesia />
  <main class="container">
    <section class="row">
      <hgroup class="col-12 mt-5 mb-2">
        <h1>{article.data.title}</h1>
        <p>{article.data.summary}</p>
        <p class="text-muted border-bottom border-dark border-3 pb-3">
          <time datetime={article.data.date}>{formattedDate}</time>
          <span class="mx-2">â€¢</span>
          <span>{article.data.categories.join(', ')}</span>
        </p>
      </hgroup>
    </section>
    <Content />
  </main>
  <Footer />
</Layout>