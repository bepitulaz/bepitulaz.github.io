---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import NavbarIndonesia from "../../components/NavbarIndonesia.astro";
import Footer from "../../components/Footer.astro";

export async function getStaticPaths() {
  const articles = await getCollection("blog", ({ id }) => {
    return id.startsWith('id/');
  });

  return articles.map((article) => {
    const category = article.data.categories[0].toLowerCase();
    const slug = article.slug.replace('id/', '');

    return {
      params: {
        post: `${category}/${slug}`,
      },
      props: { article },
    };
  });
}

const { article } = Astro.props;
const { Content } = await article.render();
// Format date into DD MMMM YYYY from article.data.date
const date = new Date(article.data.date);
const formattedDate = date.toLocaleDateString("en-GB", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<Layout title={`${article.data.title} | Asep Bagja`}>
  <NavbarIndonesia />
  <main class="container">
    <article class="row blog">
      <hgroup class="col-12 mt-5 mb-2">
        <h1>{article.data.title}</h1>
        <p class="lead">{article.data.summary}</p>
        <p class="text-muted border-bottom border-dark border-3 pb-3 ">
          <time datetime={article.data.date}>{formattedDate}</time>
          <span class="mx-2">â€¢</span>
          <span class="category-text">{article.data.categories.join(', ')}</span>
        </p>
      </hgroup>
      <Content />
    </article>
  </main>
  <Footer />
</Layout>

<style is:global>
  article.blog a {
    color: var(--asep-red-3);
    text-decoration-style: dotted;
    font-weight: normal;
  }

  article.blog a:hover {
    color: var(--asep-primary);
  }

  article.blog p {
    font-size: 1.1rem;
  }

  article.blog ol, article.blog ul {
    margin-left: 2.5rem;
    font-size: 1.1rem;
  }

  article.blog .figure {
    text-align: center;
  }

  article.blog .figure img {
    width: 70%;
  }

  hgroup .category-text {
    background-color: var(--asep-blue-4);
    color: var(--bs-light);
    padding: 0.2rem 0.5rem;
    border-radius: 5px;
  }

  @media (max-width: 575.98px) {
    article.blog .figure img {
      width: 100%;
    }
  }

  @media (max-width: 767.98px) {
    article.blog .figure img {
      width: 100%;
    }
  }
</style>